/* Blueprint Preloader - Technical Drawing Animation */

:root {
  --bp-bg-color: #000000;
  --bp-accent-color: #ffffff;
  --bp-ease-out-expo: cubic-bezier(0.19, 1, 0.22, 1);
  --bp-reveal-ease: cubic-bezier(0.77, 0, 0.175, 1);
  --bp-sync-speed: 2.2s;
}

/* --- THE UNIFIED LOADER CONTAINER --- */
.blueprint-loader-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: 9999;
  pointer-events: all;
  background-color: transparent;
  /* GPU acceleration for smoother animations */
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  will-change: opacity;
}

.blueprint-loader-container.phase-4 {
  pointer-events: none;
}

/* --- INITIAL BLACK COVER --- */
.initial-black-cover {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #000000;
  z-index: 10;
  opacity: 1;
  transition: opacity 0.5s ease-out;
}

/* Fade out black cover when phase 1 starts */
.blueprint-loader-container.phase-1 .initial-black-cover {
  opacity: 0;
  pointer-events: none;
}

/* --- BACKDROP BLUR LAYER --- */
.backdrop-blur-layer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  z-index: 1;
  transition: opacity var(--bp-sync-speed) var(--bp-reveal-ease),
              backdrop-filter var(--bp-sync-speed) var(--bp-reveal-ease),
              -webkit-backdrop-filter var(--bp-sync-speed) var(--bp-reveal-ease);
  will-change: opacity, backdrop-filter;
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
}

/* --- OVERLAY SVG --- */
.overlay-svg {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 2;
}

/* Dark overlay rect */
.dark-overlay {
  fill: rgba(0, 0, 0, 0.75);
  transition: opacity var(--bp-sync-speed) var(--bp-reveal-ease);
}

/* Mask circles - expand to reveal content */
.mask-circle {
  transition: transform var(--bp-sync-speed) var(--bp-reveal-ease);
  transform-origin: center;
  transform-box: fill-box;
  will-change: transform;
}

/* Branding Units */
.branding-unit {
  opacity: 0;
  transition: opacity 0.5s ease;
  will-change: opacity;
}

.unit-circle {
  fill: none;
  stroke: var(--bp-accent-color);
  stroke-width: 1px;
  opacity: 0.3;
}

/* Text styling: clean outline using masks to hide internal glyph overlaps */
.branding-text-stroke {
  font-family: 'Inter', sans-serif;
  font-weight: 900;
  font-size: 90px;
  fill: var(--bp-accent-color);
  stroke: var(--bp-accent-color);
  stroke-width: 3px;
  stroke-linejoin: round;
  opacity: 0;
  transform: scale(1.15);
  filter: blur(8px) drop-shadow(1px 1px 2px rgba(0,0,0,0.5));
  transition: opacity 0.4s ease, transform 0.6s var(--bp-ease-out-expo), filter 0.6s var(--bp-ease-out-expo);
}

/* Technical Blueprint Lines */
.const-line {
  stroke: var(--bp-accent-color);
  stroke-width: 0.6px;
  fill: none;
  stroke-dasharray: 2000;
  stroke-dashoffset: 2000;
  opacity: 0.15;
  transition: stroke-dashoffset 2s var(--bp-ease-out-expo),
              transform var(--bp-sync-speed) var(--bp-reveal-ease),
              opacity 1.5s var(--bp-reveal-ease);
  transform-origin: center;
  will-change: stroke-dashoffset, opacity;
}

/* Layer groups that scale */
.floorplan-layer,
.main-axes {
  will-change: transform, opacity;
  transform-origin: center;
}

.const-line.heavy {
  stroke-width: 1.2px;
  opacity: 0.3;
}

.const-line.dashed {
  stroke-dasharray: 4, 4;
}

.tick-label {
  font-size: 6px;
  fill: var(--bp-accent-color);
  opacity: 0;
  transition: opacity 1s ease 0.5s, transform var(--bp-sync-speed) var(--bp-reveal-ease);
  transform-origin: center;
}

/* --- PHASE 1: Blueprint Draw & Units Appear --- */
.blueprint-loader-container.phase-1 .const-line {
  stroke-dashoffset: 0;
}

.blueprint-loader-container.phase-1 .tick-label {
  opacity: 0.2;
}

.blueprint-loader-container.phase-1 .branding-unit {
  opacity: 1;
}

/* --- PHASE 2: The Component Snap Reveal --- */
.blueprint-loader-container.phase-2 .branding-text-stroke {
  opacity: 1;
  transform: scale(1);
  filter: blur(0px);
  animation: text-flicker 0.4s step-end forwards;
}

@keyframes text-flicker {
  0% { opacity: 0; }
  20% { opacity: 1; }
  40% { opacity: 0.4; }
  60% { opacity: 1; }
  80% { opacity: 0.7; }
  100% { opacity: 1; }
}

/* --- PHASE 3: Circles Expand to Reveal Content --- */

/* Mask circles expand to reveal more content */
.blueprint-loader-container.phase-3 .mask-circle {
  transform: scale(45);
}

/* Blueprint lines zoom out and fade */
.blueprint-loader-container.phase-3 .floorplan-layer,
.blueprint-loader-container.phase-3 .main-axes {
  transform: scale(45);
}

/* Branding units just fade out - NO zoom */
.blueprint-loader-container.phase-3 .branding-unit {
  opacity: 0;
  transition: opacity 0.8s var(--bp-reveal-ease) !important;
}

.blueprint-loader-container.phase-3 .const-line,
.blueprint-loader-container.phase-3 .tick-label {
  opacity: 0;
  transition: opacity 1s var(--bp-reveal-ease), transform var(--bp-sync-speed) var(--bp-reveal-ease) !important;
}

/* Blur fades out */
.blueprint-loader-container.phase-3 .backdrop-blur-layer {
  backdrop-filter: blur(0px);
  -webkit-backdrop-filter: blur(0px);
  opacity: 0;
}

/* Dark overlay fades */
.blueprint-loader-container.phase-3 .dark-overlay {
  opacity: 0;
}

/* --- PHASE 4: Fade out completely --- */
.blueprint-loader-container.phase-4 {
  opacity: 0;
  transition: opacity 0.5s ease;
}

/* --- RESPONSIVE ADJUSTMENTS --- */

/* Mobile-first touch and scroll handling */
.blueprint-loader-container {
  /* REMOVED touch-action: none - was blocking all scrolling on mobile */
  /* Preloader is position: fixed so it doesn't need to block touch */
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: none;
}

/* Safe area support for notched devices */
@supports (padding: env(safe-area-inset-top)) {
  .blueprint-loader-container {
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
  }
}

/* Use svh for better mobile viewport handling */
@supports (height: 100svh) {
  .blueprint-loader-container {
    height: 100svh;
  }

  .backdrop-blur-layer,
  .initial-black-cover {
    height: 100svh;
  }
}

/* Tablet screens */
@media (max-width: 1024px) {
  .const-line {
    stroke-width: 0.5px;
  }

  .const-line.heavy {
    stroke-width: 1px;
  }

  .tick-label {
    font-size: 5px;
  }
}

/* Mobile screens */
@media (max-width: 768px) {
  .backdrop-blur-layer {
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }

  .const-line {
    stroke-width: 0.4px;
    opacity: 0.1;
  }

  .const-line.heavy {
    stroke-width: 0.8px;
    opacity: 0.2;
  }

  .tick-label {
    font-size: 4px;
    opacity: 0;
  }

  .blueprint-loader-container.phase-1 .tick-label {
    opacity: 0.15;
  }

  .unit-circle {
    stroke-width: 0.8px;
  }
}

/* Small mobile screens */
@media (max-width: 480px) {
  .backdrop-blur-layer {
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  .const-line {
    stroke-width: 0.3px;
  }

  .const-line.heavy {
    stroke-width: 0.6px;
  }

  .tick-label {
    display: none;
  }

  /* Reduce circle expansion on small screens for performance */
  .blueprint-loader-container.phase-3 .mask-circle {
    transform: scale(35);
  }

  .blueprint-loader-container.phase-3 .floorplan-layer,
  .blueprint-loader-container.phase-3 .main-axes {
    transform: scale(35);
  }
}

/* Very small screens (iPhone SE, etc.) */
@media (max-width: 375px) {
  .backdrop-blur-layer {
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }

  .blueprint-loader-container.phase-3 .mask-circle {
    transform: scale(30);
  }

  .blueprint-loader-container.phase-3 .floorplan-layer,
  .blueprint-loader-container.phase-3 .main-axes {
    transform: scale(30);
  }
}

/* Landscape orientation on mobile */
@media (max-width: 896px) and (orientation: landscape) {
  .blueprint-loader-container {
    height: 100vh;
    height: 100svh;
  }

  /* Reduce blur for landscape as content is more visible */
  .backdrop-blur-layer {
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }
}

/* High DPI screens - sharper lines */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  .const-line {
    stroke-width: 0.5px;
  }

  .const-line.heavy {
    stroke-width: 1px;
  }
}

/* Reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  .blueprint-loader-container,
  .backdrop-blur-layer,
  .dark-overlay,
  .mask-circle,
  .branding-unit,
  .branding-text-stroke,
  .const-line,
  .tick-label,
  .initial-black-cover {
    transition-duration: 0.1s !important;
    animation-duration: 0.1s !important;
  }

  .blueprint-loader-container.phase-2 .branding-text-stroke {
    animation: none;
    opacity: 1;
  }
}

/* Fallback for browsers without backdrop-filter support */
@supports not (backdrop-filter: blur(1px)) {
  .backdrop-blur-layer {
    background-color: rgba(0, 0, 0, 0.85);
  }

  .blueprint-loader-container.phase-3 .backdrop-blur-layer {
    background-color: transparent;
  }
}
